<h1>Arrp Playground</h1>


<div style="max-width:500px">
<ul>
<li>Enter code into the top text area.</li>
<li>Enter the desired number of output samples to compute.</li>
<li>Press "Run".</li>
<li>
If the code compiles successfully, the desired amount of output samples will be printed in the bottom text area.
Otherwise, errors will be printed in that area.
</li>
</p>
<div>

<p>Arrp Code:</p>
<p>
<textarea id="arrp-input" cols="50" rows="10">
fib = [~:
  0 -> 0;
  1 -> 1;
  i -> fib[i-1] + fib[i-2];
];

main = fib
</textarea>
</p>

<p>
Number of output samples: <input id="out-count" type="text" value="10">
</p>

<p>
<button onclick="sendArrpInput()">Run</button>
</p>

<p>Output:</p>
<p>
<textarea readonly id="arrp-output" cols="50" rows="10">
</textarea>
</p>

<script>

function sendArrpInput() {

  var text = document.getElementById("arrp-input").value;

  var data = new Blob([text], {type: 'text/plain'});

  var out_count = document.getElementById("out-count").value;

  var xmlhttp = new XMLHttpRequest();

  console.log("Posting...\n");

  xmlhttp.onreadystatechange = function() {
      console.log("State change: " + xmlhttp.readyState);
      if (xmlhttp.readyState != 4) {
          return;
      }
      if (xmlhttp.status != 200) {
          var msg = "An error occured with the network request.\n"
                  + "HTTP status = " + xmlhttp.status + ".\n";
                  + xmlhttp.responseText;
          document.getElementById("arrp-output").value = msg;
      }
      else {
          processArrpResponse(xmlhttp.responseText);
      }
  };
  xmlhttp.open("POST", "../cgi/arrp-code-post-entry.sh" + "?out_count=" + out_count, true);
  xmlhttp.send(data);
  document.getElementById("arrp-output").value = "Computing...";
}

function processArrpResponse(text) {
    console.log("Reponse:\n" + text);
    document.getElementById("arrp-output").value = text;
}

</script>
